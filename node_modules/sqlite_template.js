
function langFilter(str){
	return /[><]/.test(str);
}
var sqlite3 = require('sqlite3').verbose();
var langTemplate = function(databasePath) {
  	var db;
	var andSql = function(key, value){
		var nameField = key;
		if(!langFilter(nameField)){
			nameField += "=";
		}
		return nameField + "'" + value + "'" ;
	};
	var orSql = function(objOr){
		var orPArt = "(";
		for(var key in objOr){
			if(key == "OR"){
				orSql(objOr.key);
			}else{
				var nameField = key;
				if(!langFilter(nameField)){
					nameField += "=";
				}
				orPArt = orPArt + nameField + "'" + objOr[key] + "'" + " OR ";
			}
		}
		return orPArt + "0)";
	}
	var connectLang = function(conditions){
		var lang = "";
		for(var key in conditions){
			if(key == "OR"){
				lang += orSql(conditions[key]) + " AND ";
			}else{
				console.log(conditions[key]);
				lang += andSql(key, conditions[key]) + " AND ";
			}
		}
		return lang + "1"
	}
	var preSql = function(con){
		var tableName = con.table;	// "tableName"
		var fieldName = con.fields.join(',');	//["id", "name"]
		var sqlang = "SELECT " + fieldName + " FROM " + tableName + " WHERE 1 AND ";
		return sqlang;
	}

	return {
		setDb: function(newPath){
			databasePath = newPath
		},
		linkDb: function(){
			db = new sqlite3.Database(databasePath);
		},
		closeDb: function(){
			db.close();
		},
		findAll: function(){

		},
		findOne: function(con){
			var sqlang = preSql(con);
			sqlang += connectLang(con.conditions)
			console.log(sqlang);
			db.get(sqlang, function(err, row){
				console.log(row);
			});
		}
	}
}
exports.langTemplate = langTemplate;
