var fs = require('fs');
var path = require('path');
var wordM = require('match_word');

function TextStream(jquery_element) {
  //events.EventEmitter.call(this);
  this.element = jquery_element;
  this.textPath = [""];
  var self = this;
  this.element.on("change", function(){
  	self.textPath = self.element.val().split(";");
  	console.log("path", self.textPath);
  })
}
TextStream.prototype.findVariant = function(originInput, formatData){
	var matchM = wordM.matchM(originInput, formatData);
	var src = this.textPath;
	if(src.length == 1 && src[0] == ""){
		return false;
	}
	var fileData = {};
	for (var i = src.length - 1; i >= 0; i--) {
		var basePath = path.basename(src[i]);
		var rs = fs.createReadStream(src[i], {encoding: 'utf-8', bufferSize: 11});
		fileData[basePath] = [];
		rs.on('data', function (chunk) {
		    rs.pause();
		    var textIndex = matchM.searchM(chunk);
		    console.log("text index", textIndex);
		    // console.log("chunk", chunk);
		    // console.log("rs", this.path);
			if(textIndex > 0){
				var filePath = path.basename(this.path)
				fileData[filePath].push(chunk.substr(textIndex, 4));
			}
			rs.resume();
		});
		rs.on('end', function () {
			
		});
	};
	console.log("fileData",fileData);	
}
exports.TextStream = TextStream; 